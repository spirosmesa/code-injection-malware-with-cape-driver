using System.Text.Json.Serialization;
using System.Text.Json;

using Analyzer.Drivers.Cape.Reporting.CapeJsonClasses;


namespace Analyzer.Drivers.Cape.Reporting;

public class ApiCall
{

    public ApiCall(CapeApiCall capeApiCall)
    {
        Category = capeApiCall.Category;
        API = capeApiCall.API;

        if (capeApiCall.Status)
            Status = 1;
        else Status = 0;

        ReturnValue = capeApiCall.ReturnValue;
        Time = capeApiCall.Time;
        ThreadId = capeApiCall.ThreadId;


        foreach (var dict in capeApiCall.Args)
        {
            //Args is a list of dictionaries
            this.Arguments.Add(dict["name"].ToString(), dict["value"]);
        }

        Caller = capeApiCall.Caller;
        ParentCaller = capeApiCall.ParentCaller;

    }

    public string? Category
    {
        get;
        set;
    }

    [JsonPropertyName("api")]
    public string API
    {
        get;
        set;
    } = string.Empty;

    public uint Status
    {
        get;
        set;
    }

    public JsonElement ReturnValue
    {
        get;
        set;
    }

    /**
    public double Time
    {
        get;
        set;
    }*/
    public string Time { get; set; }

    [JsonPropertyName("tid")]
    public string ThreadId
    {
        get;
        set;
    }

    public Dictionary<string, JsonElement> Arguments
    {
        get;
        set;
    } = new();

    public string Caller { get; set; }

    public string ParentCaller { get; set; }

    /// <inheritdoc />
    public override string ToString() => Name;
}
