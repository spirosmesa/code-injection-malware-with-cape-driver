#!/bin/bash
if [ $# == 0 ]
then
	echo "Usage: $0 <install|uninstall>"
	exit
fi

#####################
# Blocked ports
#####################

# SMTP ports
blocked_dest_ports=(25 26 465 587 2525)

# POP ports
blocked_dest_ports+=(110 995)

# IMAP3 ports
blocked_dest_ports+=(143 993)

# Misc
blocked_dest_ports+=(12345)

####################
# Blocked subnets
####################

blocked_ip="<change subnet ip here>"
blocked_subnet="255.255.0.0"


if [ $1 == "install" ]
then
	echo "Installing firewall rules..."

	# block general subnet.
	iptables -I FORWARD -i drak1 -d $blocked_ip/$blocked_subnet -j DROP
elif [ $1 == "uninstall" ]
then
	echo "Uninstalling firewall rules..."

	# unblock general subnet.
	iptables -D FORWARD -i drak1 -d $blocked_ip/$blocked_subnet -j DROP
else
	echo "Invalid command."
	exit 1
fi

for i in "${blocked_dest_ports[@]}"
do
	if [ $1 == "install" ]
	then
		echo "Blocking port $i..."
		
		# block destination port.
		iptables -I FORWARD -i drak1 -p tcp --destination-port $i -j DROP
	elif [ $1 == "uninstall" ]
	then
		echo "Unblocking port $i..."
		
		# unblock destination port.
		iptables -D FORWARD -i drak1 -p tcp --destination-port $i -j DROP
	fi
done
